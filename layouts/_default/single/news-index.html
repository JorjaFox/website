{{ .Render "global/header" }}
{{ .Render "global/main" }}

{{ $pagedate := $.Page.Date.Format "2006" }}
{{ $thisdate := time.Now.Year }}
{{ $tags     := slice $pagedate }}

{{ $news_pages    := where .Site.Pages.ByDate "Layout" "news" }}
{{ $news_articles := where $news_pages "Params.newstitle" "ne" nil }}
{{ $news_year     := where $news_articles ".Params.newsyear" "eq" $pagedate }}

{{ $len := len $news_year }}

{{ if and (ne $len 0) (ne .Params.type "main") }}<p>There {{ if gt $len 1 }}are{{ else }}is{{ end }} {{ $len }} article{{ if gt $len 1 }}s{{ end }} from {{ $pagedate }}.<p>{{ end }}

<table class="table table-striped table-borderless table-hover table-transcripts">

    <thead class="table-success">
        <tr>
            <th scope="col" width="20%">Date ({{ $pagedate }})</th>
            <th scope="col" width="20%">Source</th>
            <th scope="col" width="60%">Title</th>
        </tr>
    </thead>

    <tbody>
        {{ if eq $len 0 }}
            <tr>
                <td colspan="2">There are no articles for {{ $pagedate }} yet.</td>
            </tr>
        {{ else if eq .Params.type "main" }}
            {{ range first 5 $news_year.Reverse }}
                <tr>
                    <td>{{ .Date.Format "January 02" }}, {{ $pagedate }}</td>
                    <td><a href="{{ .Permalink }}">{{ .Params.newssource }}</a></td>
                    <td>{{ htmlUnescape .Params.newstitle }}</td>
                </tr>
            {{ end }}
        {{ else }}
            {{ range $news_year }}
                <tr>
                    <td>{{ .Date.Format "January 02" }}</td>
                    <td><a href="{{ .Permalink }}">{{ .Params.newssource }}</a></td>
                    <td>
                        {{ htmlUnescape .Params.newstitle }}
                        {{ if not .Lastmod.IsZero }}
                            <script>
                                // Current Date
                                var pubdate = new Date( {{ .Date }} );
                                var nowdate = new Date();
                                var diff    = parseInt( ( nowdate.getTime() - pubdate.getTime() ) / ( 1000 * 60  * 60 * 24 ) );
                                if ( diff <= 30 ) {
                                    document.write( "<span class='badge rounded-pill bg-success'>NEW!</span>" );
                                }
                            </script>
                        {{ end }}
                    </td>
                </tr>
            {{ end }}
        {{ end }}
    </tbody>

    <tfoot class="table-success">
        <tr>
            <th scope="col" width="20%">Date</th>
            <th scope="col" width="20%">Source</th>
            <th scope="col" width="60%">Title</th>
        </tr>
    </tfoot>
</table>
