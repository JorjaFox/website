{{ define "main" -}}
    {{- $breakpoint := $.Scratch.Get "breakpoint" -}}
    {{ $sidebar := .Render "global/sidebar" }}
    {{ $toc := .Render "single/panel-toc" }}
    {{- $flf_icon := .Params.flf_icon -}}
    {{- $list_icon := .Params.list_icon -}}

    {{ with $sidebar }}
        <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvass-sidebar" aria-inledby="offcanvas-label">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="offcanvas-label">{{ strings.FirstUpper $.Section }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="{{ T "close" }}"></button>
            </div>
            <div class="offcanvas-body">
                {{ . | safeHTML }}
            </div>
        </div>
    {{ end }}

    <div class="container-xxl flex-fill p-4 px-xxl-0">
        <div class="row row-cols-1 row-cols-{{ $breakpoint.current }}-2 row-cols-{{ $breakpoint.next }}-3">
            <div class="col col-{{ $breakpoint.next }}-2 d-none d-{{ $breakpoint.next }}-block sidebar-overflow sticky-top pt-5">
                {{ $sidebar | safeHTML }}
            </div>
            <div class="col-12 col-{{ $breakpoint.current }}-9 col-{{ $breakpoint.next }}-8 mb-5 p-4">
                {{ .Render "global/header"}}

                {{- if and .Site.Params.navigation.toc .Params.includeToc | default true -}}
                    <div class="d-{{ $breakpoint.current }}-none pb-5">{{ partial "assets/toc-dropdown.html" (dict "page" .) }}</div>
                {{- end -}}

                {{ partial "utilities/ProcessContent" (dict "page" .Page "raw" .RawContent) }}

                {{/* Display generated sections */}}
                <ul class="list-group">
                {{ if ne .Type "index" }}
                    {{ range .Data.Pages.ByTitle }}
                        <li class="list-group-item">
                            {{ if $list_icon }}
                                <span class="list-svg">{{ partial "svg" $list_icon }}</span>&nbsp;
                            {{ end }}
                            <a href="{{ .Permalink }}">{{ .Title }}</a>
                            {{ if not .Lastmod.IsZero }}
                            <script>
                                // Current Date
                                var pubdate = new Date( {{ .Lastmod }} );
                                var nowdate = new Date();
                                var diff    = parseInt( ( nowdate.getTime() - pubdate.getTime() ) / ( 1000 * 60  * 60 * 24 ) );

                                if ( diff <= 30 )
                                    document.write( "<span class='badge rounded-pill bg-success'>NEW!</span>" );
                                javascript: ;
                            </script>
                            {{ end }}
                        </li>
                    {{ end }}
                {{ end }}
                </ul>
            </div>
            <div class="col col-{{ $breakpoint.current }}-3 col-{{ $breakpoint.next }}-2 d-none d-{{ $breakpoint.current }}-block pt-5">
                {{ $toc | safeHTML }}
            </div>
        </div>
    </div>
{{ end -}}
